<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inquiry - Eat In Bloom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'eat-in-bloom-site';

        let userAuthenticated = false;

        // Rule 3: Auth Before Queries
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                userAuthenticated = true;
            } catch (e) {
                console.error("Auth failed", e);
            }
        };

        initAuth();

        window.submitInquiry = async (event) => {
            event.preventDefault();
            const btn = document.getElementById('submit-btn');
            const status = document.getElementById('status-msg');
            
            btn.disabled = true;
            btn.innerText = "SENDING...";

            try {
                // Ensure auth is ready
                if (!userAuthenticated) await initAuth();
                
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    guests: parseInt(document.getElementById('guests').value),
                    date: document.getElementById('date').value,
                    message: document.getElementById('message').value,
                    createdAt: serverTimestamp(),
                    status: 'new'
                };

                // Path: /artifacts/{appId}/public/data/inquiries
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'inquiries');
                await addDoc(colRef, formData);

                status.innerHTML = `<div class="p-4 bg-green-100 text-green-800 rounded-lg mb-6 text-center font-bold">Inquiry Sent! We'll be in touch soon.</div>`;
                document.getElementById('inquiry-form').reset();
            } catch (error) {
                console.error("Submission error: ", error);
                status.innerHTML = `<div class="p-4 bg-red-100 text-red-800 rounded-lg mb-6 text-center font-bold">Submission failed. Please email us directly at EatInBloom@gmail.com.</div>`;
            } finally {
                btn.disabled = false;
                btn.innerText = "SUBMIT INQUIRY";
            }
        };
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#3A4750', secondary: '#E3B448', background: '#F8F8F8' },
                    fontFamily: { heading: ['Georgia', 'serif'], body: ['Helvetica Neue', 'Arial', 'sans-serif'] }
                }
            }
        }
    </script>
</head>
<body class="font-body text-primary bg-background min-h-screen flex flex-col">

<header class="w-full bg-background shadow-md border-b border-primary/10 h-20 flex items-center">
    <div class="container mx-auto px-4 flex justify-between items-center">
        <a href="index.html"><h1 class="text-3xl font-heading text-primary cursor-pointer">Eat In Bloom</h1></a>
        <nav><a href="index.html" class="text-primary hover:text-secondary font-bold transition-colors">Home</a></nav>
    </div>
</header>

<main class="flex-grow container mx-auto px-4 py-12">
    <div class="max-w-3xl mx-auto">
        <div id="status-msg"></div>
        <div class="bg-primary text-background rounded-2xl shadow-2xl p-8 md:p-12">
            <h2 class="text-3xl font-heading text-secondary mb-8 text-center uppercase tracking-widest">Inquiry Form</h2>
            <form id="inquiry-form" onsubmit="submitInquiry(event)" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="text" id="name" placeholder="Your Name" class="w-full p-4 rounded-lg bg-white/10 border border-secondary/30 text-white focus:outline-none focus:border-secondary" required />
                    <input type="email" id="email" placeholder="Email Address" class="w-full p-4 rounded-lg bg-white/10 border border-secondary/30 text-white focus:outline-none focus:border-secondary" required />
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="number" id="guests" placeholder="Guest Count (2-8)" class="w-full p-4 rounded-lg bg-white/10 border border-secondary/30 text-white focus:outline-none focus:border-secondary" required min="2" max="8" />
                    <input type="text" id="date" placeholder="Preferred Date" class="w-full p-4 rounded-lg bg-white/10 border border-secondary/30 text-white focus:outline-none focus:border-secondary" />
                </div>
                <textarea id="message" placeholder="Details (Occasion, Dietary Needs, etc.)" class="w-full p-4 rounded-lg bg-white/10 border border-secondary/30 text-white h-40 focus:outline-none focus:border-secondary" required></textarea>
                <button type="submit" id="submit-btn" class="w-full py-5 bg-secondary text-primary text-xl font-bold rounded-xl hover:bg-white transition-all">SUBMIT INQUIRY</button>
            </form>
        </div>
    </div>
</main>
</body>
</html>
